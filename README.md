# Unity--Virus Intrusion

- 该游戏为作者自己为学习而制作的游戏，目的为检测目前作者的Unity游戏制作水平，并熟悉游戏中各个模块的制作流程。

## 游戏介绍

- 该游戏是一款模拟病毒入侵人体机理的策略类塔防游戏
- 核心玩法：玩家通过放置所携带的免疫细胞到病毒的入侵路线上，以抵挡病毒进入目标点（类似明日方舟）。

## 关卡生成系统

- 该模块的程序设计思路如图

![关卡生成思路](/Image_Markdown/关卡生成思路.png)

## AStar算法实现

- 该模块的程序设计思路如图

![AStar算法实现思路](/Image_Markdown/AStar算法实现思路.png)

- 这里总结AStar寻路算法的流程
1. 给定起点坐标与终点坐标，并定义gCost，hCost与fCost。
    > gCost：从起点到当前点的代价，即移动的距离。
    > hCost：从当前点到终点的预计移动距离。
    > fCost：gCost与hCost的加权值。
2. 开始遍历当前节点周围的所有节点并计算其周围节点的fCost。
3. 找出fCost最小的节点，并将其作为当前节点，并将上一个节点记为当前节点的父节点。
4. 重复2-3，直至当前节点为终点。
5. 返回的当前节点的所有父节点构成一条路径，即为最短路径。


## 敌人逻辑

- 敌人生成逻辑

![敌人生成思路](/Image_Markdown/敌人生成思路.png)

- 敌人移动逻辑
    > 这里采用上面所封装好了的AStar算法。

![敌人移动思路](/Image_Markdown/敌人移动思路.png)

## UI系统

- 该模块采用一个UI框架，包含**UIManager**和**BasePanel**两部分来管理整个UI部分。
- 其中**LevelPanel**继承自**BasePanel**，**CardItem**则是**LevelPanel**的中的一个干员选择模块。

![UI框架](/Image_Markdown/UI框架的使用.png)

## 健康系统

- 该模块包含一个摧毁事件**DestroyEvent**，一个健康处理事件**HealthEvent**,用于广播并调用所订阅的方法。

![健康模块](/Image_Markdown/健康模块.png)

## 干员放置模块

- 干员的生成是通过**CardItem**来实现的，其中运用到了**Event Trigger**组件，并在**CardItem**类中实现了鼠标点击，鼠标拖拽，鼠标释放三个事件发生的方法，从而实例化干员对象。

![干员放置并实例](/Image_Markdown/干员放置并实例.png)

## 子弹生成模块

- 子弹首先通过**Player**检测周围的**Enemy**，在检测到有**Enemy**的时候生成子弹，这里运用队列**Queue**能很好的实现让子弹优先追踪最接近目标点的**Enemy**。
- 子弹类包含子弹的移动速度以及需要到达的目标点，继承自**MonoBehavior**类，实现子弹追踪至敌人的方法

![子弹追踪逻辑](/Image_Markdown/子弹追踪逻辑.png)

